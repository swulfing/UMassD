#### load packages & data ####
#require(wham)
library(wham, lib.loc = "C:/Users/swulfing/AppData/Local/Programs/R/R-4.4.3/library/wham_test")
require(tidyverse)
require(here)
require(ggplot2)
rm(list = ls())
x <- read_asap3_dat("C:/Users/swulfing/Documents/GitHub/UMassD/YT_proj/ASAPfiles_5.14Pull/GBK.dat")
#### Run 1: Like asap ####
sel=list(model=c("age-specific","age-specific","age-specific","age-specific"),
re = c("none","none","none","none"),
initial_pars=list(c(0.1,0.25,0.5,1,1,1,1),
c(0.1,0.25,0.5,1,1,1,1),
c(0.1,0.25,0.5,1,1,1,1),
c(0.1,0.25,0.5,1,1,1,1)),
fix_pars = list(
c(4:7),
c(4:7),
c(4:7),
c(4:7)))
input <- prepare_wham_input(x,
selectivity=sel,
#recruit_model=2,
#age_comp = list(fleets = rep("multinomial",1),
#                indices = rep("multinomial", 3)),
#selectivity=sel,
# NAA_re =NAA_list,
#NAA_re = list(sigma="rec", cor ="iid"),
# catchability = q,
model_name="asap_like")
#### Run 1: Like asap ####
sel=list(model=c("age-specific","age-specific","age-specific","age-specific"),
re = c("none","none","none","none"),
initial_pars=list(c(0.1,0.25,0.5,1,1,1),
c(0.1,0.25,0.5,1,1,1),
c(0.1,0.25,0.5,1,1,1),
c(0.1,0.25,0.5,1,1,1)),
fix_pars = list(
c(4:7),
c(4:7),
c(4:7),
c(4:7)))
input <- prepare_wham_input(x,
selectivity=sel,
#recruit_model=2,
#age_comp = list(fleets = rep("multinomial",1),
#                indices = rep("multinomial", 3)),
#selectivity=sel,
# NAA_re =NAA_list,
#NAA_re = list(sigma="rec", cor ="iid"),
# catchability = q,
model_name="asap_like")
m1 <- fit_wham(input,do.osa = F, do.retro = F)
library(wham, lib.loc = "C:/Users/swulfing/AppData/Local/Programs/R/R-4.4.3/library/wham_test")
require(tidyr)
require(dplyr)
require(readxl)
require(purrr)
require(here)
require(ggplot2) # C:\Users\swulfing\AppData\Local\Programs\R\R-4.4.3\library
write.dir <- "C:/Users/swulfing/Documents/GitHub/UMassD/YT_proj"
setwd(write.dir)
gb_dat <- read_asap3_dat(here("C:/Users/swulfing/Documents/GitHub/UMassD/YT_proj/ASAPfiles_5.14Pull/GBK.DAT"))
View(gb_dat)
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
# library(pak)
# library(devtools)
# pak::pkg_install("timjmiller/wham")
# devtools::install_github("lichengxue/whamMSE", dependencies=TRUE)
# devtools::install_github("NOAA-EDAB/ecodata", dependencies=TRUE, build = FALSE)
library(wham)
library(whamMSE)
library(ecodata)
library(dplyr)
write.dir <- "C:/Users/swulfing/Documents/GitHub/UMassD/YT_proj"
setwd(write.dir)
gb_dat <- read_asap3_dat("ASAPfiles_5.14Pull/GBK.DAT")
input <- prepare_wham_input(gb_dat)
year_start  <- 1  # starting year in the burn-in period
year_end    <- 20  # end year in the burn-in period
MSE_years   <- 3     # number of years in the feedback loop
# Note: no need to include MSE_years in simulation-estimation
info <- generate_basic_info(n_stocks = input$data$n_stocks,
n_regions = input$data$n_regions,
n_indices = input$data$n_indices,
n_fleets = input$data$n_fleets,
n_seasons = input$data$n_seasons,
base.years = year_start:year_end,
n_feedback_years = MSE_years,
life_history = "medium", # Not sure if we're keeping this
n_ages = input$data$n_ages)
basic_info = info$basic_info # collect basic information
catch_info = info$catch_info # collect fleet catch information
index_info = info$index_info # collect survey information
F_info = info$F # collect fishing information
n_stocks  <- as.integer(basic_info['n_stocks'])
n_regions <- as.integer(basic_info['n_regions'])
n_fleets  <- as.integer(basic_info['n_fleets'])
n_indices <- as.integer(basic_info['n_indices'])
n_ages    <- as.integer(basic_info['n_ages'])
# Selectivity Configuration - ALEX CODE
sel2=list(
model=c("age-specific",
"logistic","logistic","logistic"),
re = c("ar1_y","none","none","none"),
initial_pars=list(
c(0.1,0.25,0.5,1,1,1), # Commercial fleet
c(2,0.3), # Spring NEFSC
c(2,0.3), # Fall NEFSC
c(2,0.3)), # DFO survey
fix_pars = list(
c(6),
c(NULL),
c(NULL),
c(NULL))
)
# CHENG SELECTIVITY
# fleet_pars <- c(5,1)
# index_pars <- c(2,1)
# sel <- list(model=rep("logistic",n_fleets+n_indices),
#             initial_pars=c(rep(list(fleet_pars),n_fleets),rep(list(index_pars),n_indices)))
# M Configuration
M <- list(model="constant",initial_means=array(c(0.57, 0.33, 0.26, 0.23, 0.22, 0.22), dim = c(n_stocks,n_regions,n_ages)))
sigma        <- "rec+1"
re_cor       <- "iid"
ini.opt      <- "equilibrium"
sigma_vals   <-  array(0.5, dim = c(n_stocks, n_regions, n_ages)) # NAA sigma
# NAA config
NAA_re <- list(N1_model=rep(ini.opt,n_stocks),
sigma=rep(sigma,n_stocks),
cor=rep(re_cor,n_stocks),
recruit_model = 3,  # rChanged from ALEX code
sigma_vals = sigma_vals) # NAA_where must be specified in basic_info!
input_NoEcov <- prepare_wham_input(basic_info = basic_info,
selectivity = sel2,
M = M,
NAA_re = NAA_re,
catch_info = catch_info,
index_info = index_info,
F = F_info)
